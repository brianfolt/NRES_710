---
title: "Exercise 7: Nested Design Models"
author: "NRES 710"
date: "Last compiled: `r Sys.Date()`"
output: 
  html_document: 
    theme: yeti
    toc: yes
    toc_float: yes
    css: styles.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE,
	cache = TRUE
)
```

## General Approach

There are three datasets to analyze for this exercise. For each dataset, please conduct the following analyses:

1. Analyze the data using a standard linear model with 'lm()'; do not include any random effects. Report your results describing the fixed effects with the standard sentence(s). Report the sample sizes associated with each test of your effects.
2. Analyze the data with random effects (random intercept) using a linear mixed-effects model with 'lme()' from the 'nlme' package. If there might be multiple random effects, consider whether they might be 'nested' and handle this appropriately in your analysis. Report your results on the fixed effects using the standard sentence(s). Report the sample sizes associated with each test of your fixed effects.
3. Report what the standard deviation due the random effect(s) is.
4. Report how the results from the 'lm()' and 'lme()' approaches differ.

Note: the 'confint' function doesn't report confidence limits from 'lme()' results the same way it does for 'lm()' results. To calculate the confidence intervals, use 'intervals(results)' instead.

## Problem 1 -- Pine Abundance

**[Dataset 1](exercise_7_dataset1.csv)** -- In this dataset, we want to understand how the abundance of Whitebark Pine Trees (*Pinus albicaulis*) varies by heat and elevation. We have four sites where we are studying *P. albicaulis* along the Carson Range; within each site, there are four plots. Each plot falls into one of four categories: low elevation and low heat, high elevation and low heat, low elevation and high heat, and high elevation and high heat. Within each plot, there are four samples where tree abundance (stems per plot) was measured. This is a fully factorial experiment. Thus, heat and elevation are two separate fixed-effects variables, and our response variable is tree abundance. Create a graph (e.g., box plots) that visualizes differences in the response variable between groups. This experimental design allows us to test for an interaction between the two variables, and we should do so! Report the results of the interaction, but remember: if the interaction isn't significant, take it out of the model before reporting the main effects. Using the standard sentences, report the 'effects' of heat, elevation, and the interaction (if there is one).

![](pictures/pic_whitebarkpine.png){width=50%}

Picture: Gary Griffith, iNaturalist

<br>

## Problem 2 -- Fixed x Random Effect interactions

Create this at a later date

<br>

## Problem 3 -- BACI design

Create this at a later date 

<br>

## Truth

If you would like to know the values used to create these datasets (i.e., 'truth'), examine the code here:

```{r}
########################## 'Truth' ############################# 
### Exercise 7: code to simulate datasets for the exploration of
### nested mixed-effects models

### Dataset 1
# Simulate study design with four sites; each site has four plots; each plot receives one of four treatments; each plot has four different samples. 
set.seed(123) # Reproducibility

## Set up study design
# Plots
n_sites <- 4
n_plots <- 4
n_samples <- 4

# Site
Site <- sort(rep(rep(1:n_sites, n_plots*n_samples)))

# Heat
Heat <- rep(c(rep(0, n_samples), rep(1, n_samples), rep(0, n_samples), rep(1, n_samples)), n_sites)

# Elevation
Elevation <- rep(c(rep(0, n_samples), rep(0, n_samples), rep(1, n_samples), rep(1, n_samples)), n_sites)

# Treatment
Treatment <- factor(rep(c("HLEL", "HHEL", "HLEH", "HHEH"), each = 4, times = n_sites),
                    levels = c("HLEL", "HHEL", "HLEH", "HHEH"))

# Plot
Plot <- rep(sort(rep(1:4, n_samples)), n_sites)

# Sample
Sample <- rep(rep(1:4, n_samples), n_sites)

## Simulate error
# Site error
SiteError <- rep(rnorm(n_sites, 0, 4), each =  n_plots * n_samples)

# Plot error
PlotError <- rep(rnorm(n_plots * n_sites, 0, 2), each = n_samples)

# Residual error (i.e., sample error)
ResidualError <- rnorm(length(Plot), 0, 1)

# Response variable -- tree stems per sample
StemDensity <- 50 + 2*Heat + 3*Elevation + 6*Heat*Elevation + SiteError + PlotError + ResidualError

# Save the data
datum <- data.frame(Site = Site, Heat = Heat, Elevation = Elevation, Treatment = Treatment, Plot = Plot, Sample = Sample, SiteError = SiteError, PlotError = PlotError, ResidualError = ResidualError, StemDensity = StemDensity)

# Save the CSV file
write.csv(datum, "exercise_7_dataset1.csv", row.names = FALSE)

```

[--go to next exercise--](exercise_8.html)
